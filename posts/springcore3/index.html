<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="스프링 IoC 컨테이너" /><meta name="author" content="ellie koooo" /><meta property="og:locale" content="en" /><meta name="description" content="@Component와 컴포넌트 스캔" /><meta property="og:description" content="@Component와 컴포넌트 스캔" /><link rel="canonical" href="https://ellie1027.github.io/posts/springcore3/" /><meta property="og:url" content="https://ellie1027.github.io/posts/springcore3/" /><meta property="og:site_name" content="Ellie Koooo" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-07T00:37:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="스프링 IoC 컨테이너" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@ellie koooo" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ellie koooo"},"dateModified":"2021-08-07T23:57:10+09:00","datePublished":"2021-08-07T00:37:00+09:00","description":"@Component와 컴포넌트 스캔","headline":"스프링 IoC 컨테이너","mainEntityOfPage":{"@type":"WebPage","@id":"https://ellie1027.github.io/posts/springcore3/"},"url":"https://ellie1027.github.io/posts/springcore3/"}</script><title>스프링 IoC 컨테이너 | Ellie Koooo</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ellie Koooo"><meta name="application-name" content="Ellie Koooo"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/63043601?s=400&u=026d8203e23399d97dbc341fd85d6c9b4d8a7f67&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ellie Koooo</a></div><div class="site-subtitle font-italic">Web Developer, Studying Data science...</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/elliekoooo" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['elliekoooo','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>스프링 IoC 컨테이너</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>스프링 IoC 컨테이너</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> ellie koooo </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Aug 7, 2021, 12:37 AM +0900" >Aug 7, 2021<i class="unloaded">2021-08-07T00:37:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, Aug 7, 2021, 11:57 PM +0900" >Aug 7, 2021<i class="unloaded">2021-08-07T23:57:10+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2022 words">11 min read</span></div></div><div class="post-content"><h1 id="component와-컴포넌트-스캔">@Component와 컴포넌트 스캔</h1><h2 id="1-컴포넌트-스캔">1) 컴포넌트 스캔</h2><blockquote><p>스프링 3.1부터 도입됨</p></blockquote><p>컴포넌트 스캔이란 스프링이 직접 클래스를 검색하여 빈으로 등록해주는 기능이다. 일일히 설정 클래스에 빈을 등록하지 않고도 원하는 클래스를 빈으로 등록할 수 있다. 빈을 등록하기 위하여 스캔 위치를 설정할 수 있는데 다음과 같은 설정 방법이 있다.</p><ul><li><strong>basePackage(String)</strong> : 해당 패키지를 기준으로 하위에 있는 클래스 파일들을 스캔한다. 속성 타입인 String이 type-safe 하지 않으므로 <strong>basePackageClasses(Class)</strong> 를 쓰는 것을 좀 더 추천한다. 해당 클래스 기준으로 그 다음에 있는 클래스들을 전부 스캔할 수 있다.<li><strong>excludeFilters / includeFilters</strong> : 빈으로 등록하지 않고 걸러내도록 설정하는 것. 어떤 애노테이션을 스캔 할지 안 할지를 결정하는 것이다.</ul><h3 id="2-component">2) @Component</h3><p>@Component 애노테이션을 들고 있으면 컴포넌트 스캔 시 빈으로 등록이 된다. 아래 애노테이션은 전부 컴포넌트 스캔 시 기본 스캔 대상에 포함되는 애노테이션이다.</p><ul><li>@Repository<li>@Service<li>@Controller<li>@Configuration<li>@Aspect</ul><p>@Aspect를 제외한 나머지 애노테이션은 실제로는 @Component 애노테이션에 대한 특수 애노테이션이다.</p><p>다만 ‘싱글톤 스코프’이기 때문에 서버 구동 후 처음에 빈들이 모두 만들어지므로, 만약 애플리케이션 컨텍스트에 등록해야할 빈이 많을 경우에는 ‘초기 구동 시간’이 오래 걸릴 수 있다. 물론 처음 구동할 때 딱 한번 생성되는 것이므로 성능적으로 큰 문제는 없으나, 구동 시간 자체에 예민한 사람이라면 스프링 5부터 들어간 ‘function’을 사용하여 빈을 등록하는 방법을 고려해 볼 수 있다.</p><p>만약 리플렉션과 프록시를 이용한다면 성능을 생각해야 하지만, functional 한 방법을 이용하여 빈을 등록하면 그런 기술을 전혀 사용하지 않아도 되기 때문에 성능상의 이점(애플리케이션 초기 구동 타임)에 조금은 도움이 될 수 있다.</p><p>인스턴스를 만들어 사용하는 functional 한 방법의 configuration 예제를 보자.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DemoSpringApplication</span><span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">MyService</span> <span class="n">myService</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="k">new</span> <span class="nf">SpringApplicationBuilder</span><span class="o">()</span>
            <span class="o">.</span><span class="na">sources</span><span class="o">(</span><span class="nc">DemoSpringApplication</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
            <span class="o">.</span><span class="na">initializers</span><span class="o">((</span><span class="nc">ApplicationContextInitializer</span><span class="o">&lt;</span><span class="nc">GenericApplicationContext</span><span class="o">&gt;)</span>
            <span class="n">applicationContext</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="n">applicationContext</span><span class="o">.</span><span class="na">registerBean</span><span class="o">(</span><span class="nc">MyService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="o">})</span>
        <span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>

</pre></table></code></div></div><h1 id="3-동작-원리">3) 동작 원리</h1><ul><li>@ComponentScan은 스캔할 패키지와 애노테이션에 대한 정보를 처리하며 실제 스캐닝은 ConfigurationClassPostProcessor라는 BeanFactoryPostProcessor에 의해 처리됨.</ul><blockquote><p>BeanFactoryPostProcessor은 다른 모든 빈들 (개발자가 만든 빈 혹은 @Bean과 같은 애노테이션으로 등록한 빈) 을 만들기 이전에 컴포넌트 스캔을 하여 적용된다. 빈 팩토리 프로세서와 유사하지만 실행 시점이 다르다.</p></blockquote><h1 id="4-bean의-scope">4) Bean의 Scope</h1><p>우리가 지금까지 등록한 Bean들에게는 전부 스코프가 있다. 그것도, 전부 싱글 스코프인 빈들만 사용해왔다. 왜냐하면 기본 스코프가 싱글톤 스코프이기 때문이다.</p><dl><dt>싱글톤 스코프<dd>애플리케이션 전반에 걸쳐서, 해당 빈의 인스턴스가 오직 한 개뿐인 것.</dl><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DemoSpringApplication</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">DemoSpringApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppRunner</span> <span class="kd">implements</span> <span class="nc">ApplicationRunner</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">Single</span> <span class="n">single</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="nc">Proto</span> <span class="n">proto</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="nc">ApplicationArguments</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">proto</span><span class="o">);</span> <span class="c1">//이 클래스에 주입된 proto</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">single</span><span class="o">.</span><span class="na">proto</span><span class="o">);</span> <span class="c1">//single 클래스가 참조하고 있는 proto</span>

    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Single</span><span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">Proto</span> <span class="n">proto</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Proto</span> <span class="nf">getProto</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">proto</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Proto</span><span class="o">{</span>
<span class="o">}</span>

<span class="c1">//결과; 같은 인스턴스를 씀.</span>
<span class="n">me</span><span class="o">.</span><span class="na">whiteship</span><span class="o">.</span><span class="na">demospring</span><span class="o">.</span><span class="na">Proto</span><span class="err">@</span><span class="mi">6</span><span class="n">b34931</span>
<span class="n">me</span><span class="o">.</span><span class="na">whiteship</span><span class="o">.</span><span class="na">demospring</span><span class="o">.</span><span class="na">Proto</span><span class="err">@</span><span class="mi">6</span><span class="n">b34931</span>

</pre></table></code></div></div><p>예제를 봐도 알수 있듯 정말 웬만한 경우에는 거의 싱글톤 스코프를 쓰게 된다.</p><dl><dt>프로토타입 스코프<dd>매번 새로운 인스턴스를 만들어서 써야하는 스코프</dl><ul><li>Request Scope<li>Session Scope<li>WebSocket Scope</ul><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre><td class="rouge-code"><pre>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DemoSpringApplication</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">DemoSpringApplication</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppRunner</span> <span class="kd">implements</span> <span class="nc">ApplicationRunner</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">ApplicationContext</span> <span class="n">ctx</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="nc">ApplicationArguments</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">Proto</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">Proto</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">Proto</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">Single</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">Single</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">Single</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>

        <span class="c1">//싱글톤 타입이 참조하는 프로토 타입</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">Single</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getProto</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">Single</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getProto</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ctx</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="nc">Single</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">getProto</span><span class="o">());</span>

    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Single</span><span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">Proto</span> <span class="n">proto</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Proto</span> <span class="nf">getProto</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">proto</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Component</span> <span class="nd">@Scope</span><span class="o">(</span><span class="s">"prototype"</span><span class="o">)</span> <span class="c1">//프로토 클래스에 스코프 애노테이션을 추가한다.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Proto</span><span class="o">{</span>
<span class="o">}</span>

<span class="c1">//결과; 프로토 타입은 빈을 받아 올때마다 새로운 인스턴스를 생성한다.</span>
<span class="n">me</span><span class="o">.</span><span class="na">whiteship</span><span class="o">.</span><span class="na">demospring</span><span class="o">.</span><span class="na">Proto</span><span class="err">@</span><span class="mi">57435801</span>
<span class="n">me</span><span class="o">.</span><span class="na">whiteship</span><span class="o">.</span><span class="na">demospring</span><span class="o">.</span><span class="na">Proto</span><span class="err">@</span><span class="mi">2</span><span class="n">da66a44</span>
<span class="n">me</span><span class="o">.</span><span class="na">whiteship</span><span class="o">.</span><span class="na">demospring</span><span class="o">.</span><span class="na">Proto</span><span class="err">@</span><span class="mi">527</span><span class="n">fc8e</span>

<span class="n">me</span><span class="o">.</span><span class="na">whiteship</span><span class="o">.</span><span class="na">demospring</span><span class="o">.</span><span class="na">Single</span><span class="err">@</span><span class="mi">6</span><span class="n">b34931</span>
<span class="n">me</span><span class="o">.</span><span class="na">whiteship</span><span class="o">.</span><span class="na">demospring</span><span class="o">.</span><span class="na">Single</span><span class="err">@</span><span class="mi">6</span><span class="n">b34931</span>
<span class="n">me</span><span class="o">.</span><span class="na">whiteship</span><span class="o">.</span><span class="na">demospring</span><span class="o">.</span><span class="na">Single</span><span class="err">@</span><span class="mi">6</span><span class="n">b34931</span>

<span class="c1">//싱글톤 타입이 프로토 타입을 참조할 경우 프로토 타입의 특성상 서로 다른 인스턴스를 뱉어야하는데 똑같은 인스턴스를 뱉음</span>
<span class="n">me</span><span class="o">.</span><span class="na">whiteship</span><span class="o">.</span><span class="na">demospring</span><span class="o">.</span><span class="na">Proto</span><span class="err">@</span><span class="mi">2</span><span class="n">da66a44</span>
<span class="n">me</span><span class="o">.</span><span class="na">whiteship</span><span class="o">.</span><span class="na">demospring</span><span class="o">.</span><span class="na">Proto</span><span class="err">@</span><span class="mi">2</span><span class="n">da66a44</span>
<span class="n">me</span><span class="o">.</span><span class="na">whiteship</span><span class="o">.</span><span class="na">demospring</span><span class="o">.</span><span class="na">Proto</span><span class="err">@</span><span class="mi">2</span><span class="n">da66a44</span>

</pre></table></code></div></div><blockquote><p>프로토타입 빈이 싱글톤 빈을 참조하면? 싱글톤 빈은 인스턴스가 하나이기 때문에 개발자가 의도한 대로 항상 같은 인스턴스가 들어온다. 프로토타입은 매번 꺼낼 때마다 새로운 인스턴스가 나가는데, 프로토타입 빈이 참조한 싱글톤타입 빈은 그때마다 항상 같은, 처음에 만들어진 바로 그 인스턴스가 나간다. 때문에 전혀 문제되지 않는다.</p></blockquote><p><strong>싱글톤 빈이 프로토 타입 빈을 참조하면?</strong></p><ul><li>계속 새로운 인스턴스가 생성되기 때문에 싱글톤 빈이 참조하는 프로토타입 빈이 업데이트 되지 않음.(위의 예제 참)</ul><p><strong>해결하려면?</strong></p><ul><li>scoped-proxy<li>Object-Provider<li>Provider (표준)</ul><h1 id="scoped-proxy">Scoped-proxy</h1><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="c1">//scoped-proxy</span>
<span class="nd">@Component</span> <span class="nd">@Scope</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"prototype"</span><span class="o">,</span> <span class="n">proxyMode</span> <span class="o">=</span> <span class="nc">ScopedProxyMode</span><span class="o">.</span><span class="na">TARGET_CLASS</span><span class="o">)</span> <span class="c1">//프로토 클래스에 스코프 애노테이션을 추가한다.</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Proto</span><span class="o">{</span>
<span class="o">}</span>

</pre></table></code></div></div><p>프록시를 쓴다는 것은 이 빈을 다른 빈들이 참조할 때 프록시로 감싸서 보내라는 것이다.</p><p><strong>왜 프록시를 써야하는가?</strong> 싱글 스코프의 빈이 프로토 타입 빈을 참조할때 직접적으로 참조하면 안되고 프록시를 거쳐서 참조해야 한다. 이럴 경우 빈 호출시마다 프록시의 인스턴스가 만들어지고 해당 인스턴스가 호출된다.</p><ul><li>자바 jdk 1.8에 있는 프록시는 인터페이스 기반의 프록시밖에 못 만드므로 예제처럼 proxyMode 속성 값을 지정해주어야 한다.</ul><h1 id="object-provider">Object-Provider</h1><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1">//Object-Provider</span>
<span class="nd">@Component</span> <span class="nd">@Scope</span><span class="o">(</span><span class="s">"prototype"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Proto</span><span class="o">{</span>
<span class="o">}</span>

<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Single</span><span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="nc">ObjectProvider</span><span class="o">&lt;</span><span class="nc">Proto</span><span class="o">&gt;</span> <span class="n">proto</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Proto</span> <span class="nf">getProto</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">proto</span><span class="o">.</span><span class="na">getIfAvailable</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><p>코드 자체에 대한 변경이 일어나는 방법. 추천하지 않음.</p><h1 id="싱글톤-객체-사용시-주의할-점">싱글톤 객체 사용시 주의할 점</h1><ul><li><strong>프로퍼티가 공유된다</strong> - 따라서 멀티 스레드 환경에서 프로퍼티 값(예를 들자면 int value = 0; 같이 선언되는 값들)이 여러군데서 변경되면서 의도하지 않은 값이 출력될 수도 있다. 따라서 반드시 스레드 세이프한 방법으로 코딩해야한다.<li><strong>ApplicationContext 초기 구동 시 인스턴스 생성</strong> - 따라서 애플리케이션 구동할 때 시간이 많이 걸릴 수도 있음.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/spring/'>Spring</a>, <a href='/categories/spring-core/'>Spring Core</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/google-analytics/" class="post-tag no-text-decoration" >google analytics</a> <a href="/tags/pageviews/" class="post-tag no-text-decoration" >pageviews</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=스프링 IoC 컨테이너 - Ellie Koooo&url=https://ellie1027.github.io/posts/springcore3/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=스프링 IoC 컨테이너 - Ellie Koooo&u=https://ellie1027.github.io/posts/springcore3/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=스프링 IoC 컨테이너 - Ellie Koooo&url=https://ellie1027.github.io/posts/springcore3/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/TIL/">210821~27_TIL</a><li><a href="/posts/design-pattern/">주요 디자인 패턴</a><li><a href="/posts/aiq/">한달한권</a><li><a href="/posts/TIL/">210807~13_TIL</a><li><a href="/posts/security03/">spring security란?</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/google-analytics/">google analytics</a> <a class="post-tag" href="/tags/pageviews/">pageviews</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/2021/">2021</a> <a class="post-tag" href="/tags/til/">TIL</a> <a class="post-tag" href="/tags/css/">css</a> <a class="post-tag" href="/tags/book/">book</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/oop/">Oop</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/springcore6/"><div class="card-body"> <span class="timeago small" >Aug 7, 2021<i class="unloaded">2021-08-07T00:37:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Resource / Validation</h3><div class="text-muted small"><p> 1) Resource 추상화 java.net.URL을 추상화 한 것. org.springframework.core.io.Resource로 java.net.URL을 감싸서 row level에 있는 리소스에 접근하는 기능을 만듬. Resource 자체를 추상화한 것. 스프링 내부에서 많이 사용하는 인터페이스...</p></div></div></a></div><div class="card"> <a href="/posts/springcore7/"><div class="card-body"> <span class="timeago small" >Aug 7, 2021<i class="unloaded">2021-08-07T00:37:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>데이터 바인딩 추상화 - PropertyEditor</h3><div class="text-muted small"><p> 1) 데이터 바인딩이란? 어떤 프로퍼티에 값을 타겟 객체에 설정하는 기능 사용자가 입력한 값을 애플리케이션 도메인 객체에 동적으로 할당하는 기능 왜 데이터 바인딩이 필요한가? 사용자가 입력하는 값은 주로 문자열인데, 그 문자열을 객체마다 가지고 있는 다양한 프로퍼티 타입(int, date, boolean..혹은 도메인 객체...</p></div></div></a></div><div class="card"> <a href="/posts/springcore8/"><div class="card-body"> <span class="timeago small" >Aug 7, 2021<i class="unloaded">2021-08-07T00:37:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>데이터 바인딩 추상화 - Converter와 Formatter</h3><div class="text-muted small"><p> 1. Converter 데이터 바인딩은 서로 다른 타입 간을 변환하는 작업이다. 프로퍼티 에디터는 오브젝트와 스트링만 바인딩이 가능한 것에 비해, 컨버터는 좀 더 제너럴한 바인딩이 가능한 인터페이스이다. S 타입을 T 타입으로 변환할 수 있는 매우 일반적인 변환기. 상태 정보 없음(Stateless, 쓰레드세이프) ConverterReg...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/springcore2/" class="btn btn-outline-primary" prompt="Older"><p>스프링 IoC 컨테이너</p></a> <a href="/posts/springcore4/" class="btn btn-outline-primary" prompt="Newer"><p>스프링 IoC 컨테이너</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/elliekoooo">elliekoooo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/google-analytics/">google analytics</a> <a class="post-tag" href="/tags/pageviews/">pageviews</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/2021/">2021</a> <a class="post-tag" href="/tags/til/">TIL</a> <a class="post-tag" href="/tags/css/">css</a> <a class="post-tag" href="/tags/book/">book</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/oop/">Oop</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ellie1027.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
