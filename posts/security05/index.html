<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="jwt 토큰 적용 예제" /><meta name="author" content="ellie koooo" /><meta property="og:locale" content="en" /><meta name="description" content="Summary" /><meta property="og:description" content="Summary" /><link rel="canonical" href="https://ellie1027.github.io/posts/security05/" /><meta property="og:url" content="https://ellie1027.github.io/posts/security05/" /><meta property="og:site_name" content="Ellie Koooo" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-06T00:37:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="jwt 토큰 적용 예제" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@ellie koooo" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ellie koooo"},"dateModified":"2021-08-08T00:01:59+09:00","datePublished":"2021-08-06T00:37:00+09:00","description":"Summary","headline":"jwt 토큰 적용 예제","mainEntityOfPage":{"@type":"WebPage","@id":"https://ellie1027.github.io/posts/security05/"},"url":"https://ellie1027.github.io/posts/security05/"}</script><title>jwt 토큰 적용 예제 | Ellie Koooo</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Ellie Koooo"><meta name="application-name" content="Ellie Koooo"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/63043601?s=400&u=026d8203e23399d97dbc341fd85d6c9b4d8a7f67&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Ellie Koooo</a></div><div class="site-subtitle font-italic">Web Developer, Studying Data science...</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/elliekoooo" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['elliekoooo','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>jwt 토큰 적용 예제</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>jwt 토큰 적용 예제</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> ellie koooo </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Aug 6, 2021, 12:37 AM +0900" >Aug 6, 2021<i class="unloaded">2021-08-06T00:37:00+09:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Aug 8, 2021, 12:01 AM +0900" >Aug 8, 2021<i class="unloaded">2021-08-08T00:01:59+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2458 words">13 min read</span></div></div><div class="post-content"><h1 id="summary">Summary</h1><p>지난 포스팅에서는 form based 인증이 어떤 과정으로 이뤄지는지 알아봤다. 그런데 내가 구축하고 싶은 것은 TOKEN을 기반으로 한 인증 시스템이다. ✊ 이 포스팅에서는 JWT TOKEN에 관하여 간략히 설명하고 실제 프로젝트에 적용한 예제를 설명한다.</p><p>왜 TOKEN으로 인증하는 시스템을 만들어야 할까? 다음과 같은 이유들이 있다.</p><h1 id="장점">장점</h1><ul><li>Fast<li>Stateless(무상태성) : 데이터베이스나 세션이 필요없다. 유저가 로그인을 하기 위한 모든 정보는 토큰에 있다.<li>여러 서비스에서 접근이 가능하다. : 웹앱, IOS, Android 등 서비스마다 다른 인증 방식을 사용하는데, 토큰 인증 방식은 어느 서비스나 사용이 가능하다.</ul><h1 id="단점">단점</h1><ul><li>비밀키(토큰을 만들때 쓰이는 키)가 손상될 수 있음.<li>로그인 한 사용자 표시되지 않음 : 사용자가 로그인했는지, 로그아웃했는지 이력을 남길 수 없음.<li>토큰이 탈취될 수 있음.</ul><h1 id="jwt-token-인증-방식">JWT TOKEN 인증 방식</h1><p><img data-proofer-ignore data-src="images/springsecurity_jwt01.png" alt="" /></p><ul><li>클라이언트에서 서버에게 credentials를 보낸다.<li>서버는 credentials를 validate하고 인증 완료시 signs token을 생성한다.<li>생성한 토큰을 클라이언트로 보낸다.<li>클라이언트는 토큰을 쿠키 혹은 로컬저장소 등에 보관하고 있다가 모든 리퀘스트와 함께 보낸다.<li>받은 토큰을 필터에서 verity한다.</ul><h1 id="토이-프로젝트-적용-예제">토이 프로젝트 적용 예제</h1><p>토이 프로젝트는 데이터 전송 시 ajax를 사용한다. 프론트 단에서 다음과 같은 자바스크립트 함수를 만들었다. username과 password가 필드로 포함된 폼데이터를 JSON 오브젝트로 만들어 서버에 넘긴다.</p><div lang="html" class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"form-signin"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">id=</span><span class="s">"myForm"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"username"</span> <span class="na">class=</span><span class="s">"sr-only"</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">id=</span><span class="s">"username"</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">placeholder=</span><span class="s">"Usernameeeee"</span> <span class="na">required=</span><span class="s">""</span> <span class="na">autofocus=</span><span class="s">""</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"password"</span> <span class="na">class=</span><span class="s">"sr-only"</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"password"</span> <span class="na">id=</span><span class="s">"password"</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">class=</span><span class="s">"form-control"</span> <span class="na">placeholder=</span><span class="s">"Passworddddd"</span> <span class="na">required=</span><span class="s">""</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  .......
<span class="nt">&lt;/form&gt;</span>
</pre></table></code></div></div><div lang="javascript" class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nf">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#myForm</span><span class="dl">"</span><span class="p">).</span><span class="nf">serializeObject</span><span class="p">();</span>
<span class="nx">$</span><span class="p">.</span><span class="nf">ajax</span><span class="p">({</span>
  <span class="na">type</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">url</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">${contextPath}/login</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">contentType</span> <span class="p">:</span> <span class="dl">"</span><span class="s2">application/json</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">data</span> <span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span>
  <span class="na">async</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">cache</span> <span class="p">:</span><span class="kc">false</span><span class="p">,</span> <span class="c1">// 캐시 여부</span>
  <span class="na">success</span> <span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">response</span><span class="p">){</span>
    <span class="nf">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">정상적으로 로그인되었습니다.</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="na">error</span>   <span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">jqXHR</span><span class="p">){</span>
    <span class="nf">alert</span><span class="p">(</span><span class="dl">"</span><span class="s2">error</span><span class="dl">"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></table></code></div></div><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="nf">UsernamePasswordAuthenticationFilter</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="k">new</span> <span class="nc">AntPathRequestMatcher</span><span class="o">(</span><span class="s">"/login"</span><span class="o">,</span> <span class="s">"POST"</span><span class="o">));</span>
<span class="o">}</span>
</pre></table></code></div></div><p>화면의 로그인 버튼을 누르면 사용자가 입력한 유저네임과 패스워드는 JSON 형태로 Http Request에 실려 서버로 날아간다. 이 요청은 디스패쳐 서블릿에 닿기 전에 먼저 UsernamePasswordAuthenticationFilter에 걸리게 된다.</p><p>정확히는, JWT TOKEN을 생성하기 위하여 UsernamePasswordAuthenticationFilter를 상속받아 만든 새로운 필터이다. UsernamePasswordAuthenticationFilter를 상속받으면 attemptAuthentication 메서드와 successfulAuthentication를 재정의할수있다.</p><p>이름에서 직관적으로 알 수 있듯, attemptAuthentication로 인증을 시도한 후 성공할 시 successfulAuthentication로 가서 성공 후처리 작업을 한다. 만일 인증을 실패할 시 RuntimeException을 발생시킨다.(AuthenticationException가 RuntimeException를 상속받아 만들어진 클래스이기 때문)</p><p>자세하게 알아보면 attemptAuthentication에서는</p><ul><li>사용자가 입력한 JSON 형태의 데이터(유저네임, 패스워드)를 JwtAuthenticationRequest에 담는다<li>JwtAuthenticationRequest에서 가져온 데이터로 Authentication 객체를 생성한다<li>생성한 Authentication 객체를 authenticationManager의 인자로 넘겨 인증을 진행한다. 과 같은 과정을 거친다.</ul><p>인증이 성공할 경우(Authentication가 정상적으로 return 될 경우), successfulAuthentication가 실행된다. 이 메서드에서는 앞으로 인증에 쓰일 JWT TOKEN을 만들어 쿠키에 넣어주면 된다. (로컬 스토리지 등 다른 옵션이 있지만 나는 쿠키를 선택하였다.)</p><p>예제 코드를 따라가며 설명을 보자.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtAuthenticationFilter</span> <span class="kd">extends</span> <span class="nc">UsernamePasswordAuthenticationFilter</span>  <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">AuthenticationManager</span> <span class="n">authenticationManager</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">SecretKey</span> <span class="n">secretKey</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">JwtAuthenticationFilter</span><span class="o">(</span><span class="nc">AuthenticationManager</span> <span class="n">authenticationManager</span><span class="o">,</span>
                                   <span class="nc">SecretKey</span> <span class="n">secretKey</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">authenticationManager</span> <span class="o">=</span> <span class="n">authenticationManager</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">secretKey</span> <span class="o">=</span> <span class="n">secretKey</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/* 인증 시도하는 메소드 */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Authentication</span> <span class="nf">attemptAuthentication</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                                                <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">AuthenticationException</span> <span class="o">{</span>


      <span class="k">try</span> <span class="o">{</span>
            <span class="cm">/* 1. 사용자가 입력한 JSON 오브젝트를 읽어들인다. */</span>
            <span class="nc">BufferedReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getReader</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>

            <span class="cm">/* 2. ObjectMapper를 이용하여 JSON 데이터를 파싱하여 JwtAuthenticationRequest에 값을 넣는다.  */</span>
            <span class="nc">JwtAuthenticationRequest</span> <span class="n">jwtAuthenticationRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectMapper</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">line</span><span class="o">,</span> <span class="nc">JwtAuthenticationRequest</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

            <span class="cm">/* 3. null 처리를 해준다. */</span>
            <span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isNullOrEmpty</span><span class="o">(</span><span class="n">jwtAuthenticationRequest</span><span class="o">.</span><span class="na">getUsername</span><span class="o">())</span> <span class="o">||</span>
                    <span class="nc">StringUtils</span><span class="o">.</span><span class="na">isNullOrEmpty</span><span class="o">(</span><span class="n">jwtAuthenticationRequest</span><span class="o">.</span><span class="na">getPassword</span><span class="o">()))</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">AuthenticationServiceException</span><span class="o">(</span><span class="s">"Username or Password not provided"</span><span class="o">);</span>
            <span class="o">}</span>

            <span class="cm">/* 4. UsernamePasswordAuthenticationToken(Authentication 인터페이스의 구현체)를 이용하여 Authentication 인증 객체를 생성한다.
             사용자가 입력한 유저네임과 패스워드를 이용한다. */</span>
            <span class="nc">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UsernamePasswordAuthenticationToken</span><span class="o">(</span>
                    <span class="n">jwtAuthenticationRequest</span><span class="o">.</span><span class="na">getUsername</span><span class="o">(),</span>
                    <span class="n">jwtAuthenticationRequest</span><span class="o">.</span><span class="na">getPassword</span><span class="o">()</span>
            <span class="o">);</span>

            <span class="cm">/* 5. authenticationManager에서 인증하도록 인증 객체를 전달한다.(전 편 인증 과정 참조) */</span>
            <span class="nc">Authentication</span> <span class="n">authenticate</span> <span class="o">=</span> <span class="n">authenticationManager</span><span class="o">.</span><span class="na">authenticate</span><span class="o">(</span><span class="n">authentication</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">authenticate</span><span class="o">;</span>

        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="cm">/* 인증 성공 후 진입하는 메소드 */</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">successfulAuthentication</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                                            <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
                                            <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">,</span>
                                            <span class="nc">Authentication</span> <span class="n">authResult</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>

        <span class="cm">/* 인증을 성공했으니 이제 사용할 토큰을 만들자. 인증 객체에서 가져온 유저네임, 유저가 가지고 있는 권한 등을 이용해 토큰을 만든다.
        만든 날짜와 토큰이 만료될 날짜도 정해준다. 보통 액세스 토큰은 날짜를 짧게 설정한다.
        그리고 비밀키로 sign 해준다.
        */</span>
        <span class="nc">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="nc">Jwts</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
                <span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="n">authResult</span><span class="o">.</span><span class="na">getName</span><span class="o">())</span>
                <span class="o">.</span><span class="na">claim</span><span class="o">(</span><span class="s">"authorities"</span><span class="o">,</span> <span class="n">authResult</span><span class="o">.</span><span class="na">getAuthorities</span><span class="o">())</span>
                <span class="o">.</span><span class="na">setIssuedAt</span><span class="o">(</span><span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Date</span><span class="o">())</span>
                <span class="o">.</span><span class="na">setExpiration</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">+</span> <span class="mi">600000</span><span class="o">))</span>
                <span class="o">.</span><span class="na">signWith</span><span class="o">(</span><span class="n">secretKey</span><span class="o">)</span>
                <span class="o">.</span><span class="na">compact</span><span class="o">();</span>


        <span class="cm">/* 쿠키에 "Authorization" 이라는 이름으로 토큰을 저장한다. Bearer 인증 방식을 사용하여 토큰 앞에 "Bearer "을 붙여야 한.  */</span>
        <span class="nc">Cookie</span> <span class="n">cookie</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Cookie</span><span class="o">(</span>
                <span class="nc">HttpHeaders</span><span class="o">.</span><span class="na">AUTHORIZATION</span><span class="o">,</span>
                <span class="nc">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="s">"Bearer "</span><span class="o">,</span> <span class="s">"UTF-8"</span><span class="o">)+</span><span class="n">accessToken</span><span class="o">);</span>

        <span class="cm">/* 보안을 위하여 httponly 설정을 해줌 */</span>
        <span class="n">cookie</span><span class="o">.</span><span class="na">setHttpOnly</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

        <span class="c1">//쿠키에 액세스토큰을 저장한다.</span>
        <span class="n">response</span><span class="o">.</span><span class="na">addCookie</span><span class="o">(</span><span class="n">cookie</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>이제 사용자의 리퀘스트마다 인증을 담당해줄 액세스 토큰이 만들어졌다. 그런데 커스텀 필터이므로 설정 파일에서 등록해주어야 한다. 스프링 시큐리티 설정 파일인 AppSecurityConfig를 보자. configure 메소드에 addFilter로 JwtAuthenticationFilter를 추가해주면 된다.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppSecurityConfig</span> <span class="kd">extends</span> <span class="nc">WebSecurityConfigurerAdapter</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="o">(</span><span class="nc">HttpSecurity</span> <span class="n">http</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="n">http</span>
                <span class="o">.</span><span class="na">csrf</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span>
                <span class="c1">//.csrf()</span>
                <span class="c1">//    .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())</span>
                <span class="c1">//    .and()</span>
                <span class="o">.</span><span class="na">httpBasic</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span>
                <span class="o">.</span><span class="na">formLogin</span><span class="o">().</span><span class="na">disable</span><span class="o">()</span>
                <span class="o">.</span><span class="na">sessionManagement</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">sessionCreationPolicy</span><span class="o">(</span><span class="nc">SessionCreationPolicy</span><span class="o">.</span><span class="na">STATELESS</span><span class="o">)</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">addFilter</span><span class="o">(</span><span class="k">new</span> <span class="nc">JwtAuthenticationFilter</span><span class="o">(</span><span class="n">authenticationManager</span><span class="o">(),</span> <span class="n">secretKey</span><span class="o">))</span>
                <span class="o">.</span><span class="na">addFilterAfter</span><span class="o">(</span><span class="k">new</span> <span class="nc">JwtTokenVerifier</span><span class="o">(</span><span class="n">secretKey</span><span class="o">),</span> <span class="nc">JwtAuthenticationFilter</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">exceptionHandling</span><span class="o">()</span>
                <span class="o">.</span><span class="na">accessDeniedHandler</span><span class="o">(</span><span class="n">customAccessDeniedHandler</span><span class="o">())</span>
                <span class="o">.</span><span class="na">and</span><span class="o">()</span>
                <span class="o">.</span><span class="na">authorizeRequests</span><span class="o">()</span>
                <span class="o">.</span><span class="na">antMatchers</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="s">"/login"</span><span class="o">,</span> <span class="s">"/resources/**/**"</span><span class="o">).</span><span class="na">permitAll</span><span class="o">()</span>
                <span class="o">.</span><span class="na">anyRequest</span><span class="o">()</span>
                <span class="o">.</span><span class="na">authenticated</span><span class="o">();</span>
                <span class="c1">//.permitAll();</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>addFilter 밑에 보면 addFilterAfter 함수가 있다. 말 그대로 어떤 필터 다음에 실행될 필터를 추가하는 것이다. 방금 만든 JwtAuthenticationFilter 다음에 JwtTokenVerifier 필터를 추가하였다. 이 필터는 이름에서 알 수 있듯 JWT TOKEN을 검증하는 필터이다.</p><p>이 필터가 하는 일은 사용자의 리퀘스트에 포함된 JWT TOKEN을 파싱하여 유저네임, 유저권한, 토큰 만료일 등을 확인하고 합당한 요청이면 다시 인증 객체를 만드는 것이다.</p><p>왜 굳이 다시 인증 객체를 만드냐면, password같은 민감한 정보를 빼고 인증 객체를 만들어야 하기 때문이다.</p><p>토큰 검증 필터는 OncePerRequestFilter를 상속받아 만든다. OncePerRequestFilter는 같은 리퀘스트에 대해서는 단 한번의 처리가 수행되는 것을 보장하는 클래스이다.</p><div lang="java" class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JwtTokenVerifier</span> <span class="kd">extends</span> <span class="nc">OncePerRequestFilter</span> <span class="o">{</span>

    <span class="c1">//토큰 생성시 비밀키 가져오는 클래스</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">SecretKey</span> <span class="n">secretKey</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">JwtTokenVerifier</span><span class="o">(</span><span class="nc">SecretKey</span> <span class="n">secretKey</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">secretKey</span> <span class="o">=</span> <span class="n">secretKey</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doFilterInternal</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                                    <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
                                    <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span><span class="o">,</span> <span class="nc">IOException</span> <span class="o">{</span>

        <span class="nc">String</span> <span class="n">requestHeader</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="nc">Cookie</span><span class="o">[]</span> <span class="n">requestCookies</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getCookies</span><span class="o">();</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">requestCookies</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//쿠키에서 암호화된 헤더를 찾음("Authorizaion" 이라는 이름으로 된 쿠키를 찾음)</span>
            <span class="k">for</span> <span class="o">(</span><span class="nc">Cookie</span> <span class="n">requestCookie</span> <span class="o">:</span> <span class="n">requestCookies</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="nc">HttpHeaders</span><span class="o">.</span><span class="na">AUTHORIZATION</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">requestCookie</span><span class="o">.</span><span class="na">getName</span><span class="o">()))</span> <span class="o">{</span>
                    <span class="n">requestHeader</span> <span class="o">=</span> <span class="n">requestCookie</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
                    <span class="k">break</span><span class="o">;</span>
                <span class="o">}</span>
            <span class="o">}</span>

            <span class="c1">//null 처리를 한다. or 혹은 'Bearer '로 시작하는 토큰을 찾지 못하면 요청을 넘김</span>
            <span class="k">if</span> <span class="o">(</span><span class="nc">Strings</span><span class="o">.</span><span class="na">isNullOrEmpty</span><span class="o">(</span><span class="n">requestHeader</span><span class="o">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">requestHeader</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="nc">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="s">"Bearer "</span><span class="o">,</span> <span class="s">"UTF-8"</span><span class="o">)))</span> <span class="o">{</span>
                <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>

            <span class="c1">//액세스토큰(JwtAuthenticationFilter 클래스에서 만든 토큰)을 변수에 담는다.</span>
            <span class="nc">String</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="n">requestHeader</span><span class="o">.</span><span class="na">replace</span><span class="o">(</span><span class="nc">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="s">"Bearer "</span><span class="o">,</span> <span class="s">"UTF-8"</span><span class="o">),</span> <span class="s">" "</span><span class="o">);</span>

            <span class="k">try</span> <span class="o">{</span>

                <span class="c1">//Jws 라이브러리를 이용하여 변수에 담은 jwt 토큰을 파싱해준다.</span>
                <span class="nc">Jws</span><span class="o">&lt;</span><span class="nc">Claims</span><span class="o">&gt;</span> <span class="n">claimsJws</span> <span class="o">=</span> <span class="nc">Jwts</span><span class="o">.</span><span class="na">parser</span><span class="o">()</span>
                    <span class="o">.</span><span class="na">setSigningKey</span><span class="o">(</span><span class="n">secretKey</span><span class="o">)</span>
                    <span class="o">.</span><span class="na">parseClaimsJws</span><span class="o">(</span><span class="n">accessToken</span><span class="o">);</span>

                <span class="c1">//유저네임, 권한 등을 변수에 담아 새로운 인증 객체를 생성한다. 이때, 비밀번호 같은 민감한 정보는 넣지 않는다.</span>
                <span class="nc">Claims</span> <span class="n">body</span> <span class="o">=</span> <span class="n">claimsJws</span><span class="o">.</span><span class="na">getBody</span><span class="o">();</span>

                <span class="nc">String</span> <span class="n">username</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="na">getSubject</span><span class="o">();</span>

                <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">authorities</span> <span class="o">=</span> <span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;&gt;)</span> <span class="n">body</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"authorities"</span><span class="o">);</span>

                <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">SimpleGrantedAuthority</span><span class="o">&gt;</span> <span class="n">simpleGrantedAuthorities</span> <span class="o">=</span> <span class="n">authorities</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                        <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">m</span> <span class="o">-&gt;</span> <span class="k">new</span> <span class="nc">SimpleGrantedAuthority</span><span class="o">(</span><span class="n">m</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"authority"</span><span class="o">)))</span>
                        <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toSet</span><span class="o">());</span>

                <span class="nc">Authentication</span> <span class="n">authentication</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UsernamePasswordAuthenticationToken</span><span class="o">(</span>
                        <span class="n">username</span><span class="o">,</span>
                        <span class="kc">null</span><span class="o">,</span>
                        <span class="n">simpleGrantedAuthorities</span>
                <span class="o">);</span>

                <span class="c1">//민감한 정보를 빼고 만든 인증 객체를 SecurityContextHolder에 넣는다.</span>
                <span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">setAuthentication</span><span class="o">(</span><span class="n">authentication</span><span class="o">);</span>

            <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">JwtException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalStateException</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Token %s cannot be trust"</span><span class="o">,</span> <span class="n">accessToken</span><span class="o">));</span>
            <span class="o">}</span>
            <span class="c1">//filter1에서 filter2로 넘겨줘야함</span>
            <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>이제 모든 작업이 완료되었다. 로그인을 해보면 정상적으로 쿠키에 Authorization이라는 이름으로 토큰이 들어가 있을 것이다 😝</p><p><img data-proofer-ignore data-src="images/springsecurity_loginok.png" alt="" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/spring/'>Spring</a>, <a href='/categories/spring-security/'>Spring Security</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/google-analytics/" class="post-tag no-text-decoration" >google analytics</a> <a href="/tags/pageviews/" class="post-tag no-text-decoration" >pageviews</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=jwt 토큰 적용 예제 - Ellie Koooo&url=https://ellie1027.github.io/posts/security05/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=jwt 토큰 적용 예제 - Ellie Koooo&u=https://ellie1027.github.io/posts/security05/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=jwt 토큰 적용 예제 - Ellie Koooo&url=https://ellie1027.github.io/posts/security05/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/TIL/">210821~27_TIL</a><li><a href="/posts/design-pattern/">주요 디자인 패턴</a><li><a href="/posts/aiq/">한달한권</a><li><a href="/posts/TIL/">210807~13_TIL</a><li><a href="/posts/security03/">spring security란?</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/google-analytics/">google analytics</a> <a class="post-tag" href="/tags/pageviews/">pageviews</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/2021/">2021</a> <a class="post-tag" href="/tags/til/">TIL</a> <a class="post-tag" href="/tags/css/">css</a> <a class="post-tag" href="/tags/book/">book</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/oop/">Oop</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/security01/"><div class="card-body"> <span class="timeago small" >Aug 6, 2021<i class="unloaded">2021-08-06T00:37:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>java configuration</h3><div class="text-muted small"><p> Introduction 토이 프로젝트를 하면서 로그인 기능을 추가해야겠다고 생각했는데, 마침 스프링 기반 프로젝트를 하는 김에 스프링 시큐리티를 공부하며 적용해보았다. 확실히 로그인 모듈을 스스로 만들어보면, 프레임워크가 어떻게 동작하는지 잘 알 수 있는 것 같다. 😄 이왕 하는 김에 basic auth나 form-based 인증보다는 JWT 토큰 ...</p></div></div></a></div><div class="card"> <a href="/posts/security02/"><div class="card-body"> <span class="timeago small" >Aug 6, 2021<i class="unloaded">2021-08-06T00:37:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>spring security configuration</h3><div class="text-muted small"><p> 1. 의존성 추가 스프링 시큐리티 라이브러리를 메이븐에 추가하자. 먼저 spring-security-web, spring-security-config 라이브러리를 각 스프링 버전에 맞춰 추가해줘야 한다. (스프링 MVC 프레임워크용이고 스프링 부트는 다른 라이브러리를 추가해줘야 한다) &lt;dependency&gt; &lt;groupId&...</p></div></div></a></div><div class="card"> <a href="/posts/security04/"><div class="card-body"> <span class="timeago small" >Aug 6, 2021<i class="unloaded">2021-08-06T00:37:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>spring security 내부 인증 과정</h3><div class="text-muted small"><p> Summary 다음은 스프링 시큐리티의 인증이 완료되는 과정을 나타낸 그림이다. 인증과정을 간단하게 설명하자면 사용자로부터 받은 리퀘스트를 Authentication Filter (List) 를 거쳐 인증을 완료 후(1~9) 생성된 Authentication 객체를 SecurityContext에 저장한다.(10) ✨ 사용자는 Se...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/security04/" class="btn btn-outline-primary" prompt="Older"><p>spring security 내부 인증 과정</p></a> <a href="/posts/security_deep01/" class="btn btn-outline-primary" prompt="Newer"><p>spring security authentication</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/elliekoooo">elliekoooo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/google-analytics/">google analytics</a> <a class="post-tag" href="/tags/pageviews/">pageviews</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/2021/">2021</a> <a class="post-tag" href="/tags/til/">TIL</a> <a class="post-tag" href="/tags/css/">css</a> <a class="post-tag" href="/tags/book/">book</a> <a class="post-tag" href="/tags/design-pattern/">Design Pattern</a> <a class="post-tag" href="/tags/javascript/">javascript</a> <a class="post-tag" href="/tags/oop/">Oop</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ellie1027.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
